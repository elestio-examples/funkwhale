ports:
  - protocol: "HTTPS"
    targetProtocol: "HTTP"
    listeningPort: "443"
    targetPort: "5000"
    targetIP: "172.17.0.1"
    public: true
    path: "/"
    isAuth: false
environments:
  - key: "ADMIN_PASSWORD"
    value: "random_password"
  - key: "ADMIN_EMAIL"
    value: "[EMAIL]"
  - key: "SOFTWARE_VERION_TAG"
    value: "1.3.0-rc1"
  - key: "FUNKWHALE_HOSTNAME"
    value: "[CI_CD_DOMAIN]/"
  - key: "FUNKWHALE_PROTOCOL"
    value: "https"
  - key: "NGINX_MAX_BODY_SIZE"
    value: "100M"
  - key: "FUNKWHALE_API_IP"
    value: "172.17.0.1"
  - key: "FUNKWHALE_API_PORT"
    value: "5000"
  - key: "FUNKWHALE_WEB_WORKERS"
    value: "4"
  - key: "LOGLEVEL"
    value: "error"
  - key: "DATABASE_URL"
    value: "postgresql://postgres:random_password@postgres:5432/funkwhale_database"
  - key: "EMAIL_CONFIG"
    value: "smtp://172.17.0.1:25/?skip_ssl_verify=true&legacy_ssl=false&smtp_ssl_enabled=false&disable_starttls=true"
  - key: "ACCOUNT_EMAIL_VERIFICATION_ENFORCE"
    value: "false"
  - key: "DEFAULT_FROM_EMAIL"
    value: "[DOMAIN]@vm.elestio.app"
  - key: "REVERSE_PROXY_TYPE"
    value: "nginx"
  - key: "REDIS_HOST"
    value: "redis"
  - key: "REDIS_PASSWORD"
    value: "random_password"
  - key: "REDIS_PORT"
    value: "6379"
  - key: "REDIS_DATABASE"
    value: "0"
  - key: "CACHE_URL"
    value: "redis://:random_password@redis:6379/0"
  - key: "DJANGO_SETTINGS_MODULE"
    value: "config.settings.production"
  - key: "DJANGO_ADMIN_URL"
    value: "^api/admin/"
  - key: "FUNKWHALE_FRONTEND_PATH"
    value: "/srv/funkwhale/front/dist"
  - key: "MEDIA_ROOT"
    value: "/srv/funkwhale/data/media"
  - key: "MUSIC_DIRECTORY_PATH"
    value: "/music"
  - key: "STATIC_ROOT"
    value: "/srv/funkwhale/data/static"
  - key: "MUSIC_DIRECTORY_SERVE_PATH"
    value: "./funkwhale/data/music"
  - key: "DJANGO_ALLOWED_HOSTS"
    value: "'localhost,nginx,0.0.0.0,[CI_CD_DOMAIN]'"
  # - key: "MEDIA_URL"
  #   value: "[CI_CD_DOMAIN]/media/"
  - key: "PROXY_MEDIA"
    value: "true"
  - key: "EXTERNAL_MEDIA_PROXY_ENABLED"
    value: "true"
  - key: "FEDERATION_OBJECT_FETCH_DELAY"
    value: "4320"
  - key: "FEDERATION_DUPLICATE_FETCH_DELAY"
    value: "3000"

config:
  runTime: "dockerCompose"
  version: ""
  framework: ""
  buildCommand: "docker-compose build"
  buildDir: "/"
  runCommand: "docker-compose up -d"
  icon: ""
  screenshot: "funkwhale.png"
lifeCycleConfig:
  preInstallCommand: "./scripts/preInstall.sh"
  postInstallCommand: "./scripts/postInstall.sh"
  preBackupCommand: "./scripts/preBackup.sh"
  postBackupCommand: "./scripts/postBackup.sh"
  preRestoreCommand: "./scripts/preRestore.sh"
  postRestoreCommand: "./scripts/postRestore.sh"
webUI:
  - url: "https://[CI_CD_DOMAIN]"
    label: "FunkWhale Admin"
    login: "root"
    password: "[ADMIN_PASSWORD]"
